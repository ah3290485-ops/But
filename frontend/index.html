<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ø§Ù„ØªÙ‚Ø§Ø· ØµÙˆØ±Ø© ÙˆØ¥Ø±Ø³Ø§Ù„ Ù„ØªÙ„ØºØ±Ø§Ù…</title>
  <style>
    body{font-family:tahoma;background:#111;color:#fff;margin:0;padding:18px}
    .card{max-width:520px;margin:auto;background:#1b1b1b;padding:16px;border-radius:14px}
    h2{margin:0 0 10px}
    .small{font-size:13px;color:#bbb;line-height:1.7}
    button{width:100%;padding:12px;margin:8px 0;border:0;border-radius:12px;font-size:16px}
    .primary{background:#2f7dff;color:#fff}
    .danger{background:#ff3b3b;color:#fff}
    video,img{width:100%;border-radius:12px;margin-top:10px;background:#000}
  </style>
</head>
<body>
  <div class="card">
    <h2>ğŸ“· Ø§Ù„ØªÙ‚Ø§Ø· ØµÙˆØ±Ø©</h2>
    <div class="small">
      ÙŠØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ÙÙ‚Ø· Ø¨Ø¹Ø¯ Ù…ÙˆØ§ÙÙ‚ØªÙƒØŒ ÙˆÙ„Ù† ØªÙØ±Ø³Ù„ Ø£ÙŠ ØµÙˆØ±Ø© Ø¥Ù„Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„.
    </div>

    <button id="startBtn" class="primary">ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§</button>
    <button id="snapBtn" class="primary" disabled>Ø§Ù„ØªÙ‚Ø§Ø· ÙˆØ¥Ø±Ø³Ø§Ù„ Ù„Ù„ØªÙ„ØºØ±Ø§Ù…</button>
    <button id="stopBtn" class="danger" disabled>Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§</button>

    <div id="status" class="small"></div>

    <video id="video" autoplay playsinline></video>
    <img id="preview" style="display:none" />
  </div>

<script>
  const API_BASE = "https://PUT-YOUR-SERVER-URL-HERE";

  const video = document.getElementById("video");
  const preview = document.getElementById("preview");
  const startBtn = document.getElementById("startBtn");
  const snapBtn = document.getElementById("snapBtn");
  const stopBtn = document.getElementById("stopBtn");
  const statusEl = document.getElementById("status");
  let stream = null;

  const setStatus = t => statusEl.textContent = t;

  startBtn.onclick = async () => {
    try {
      stream = await navigator.mediaDevices.getUserMedia({ video:true });
      video.srcObject = stream;
      snapBtn.disabled = false;
      stopBtn.disabled = false;
      setStatus("ğŸ“¸ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø´ØºØ§Ù„Ø©");
    } catch {
      setStatus("âŒ ÙØ´Ù„ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§");
    }
  };

  stopBtn.onclick = () => {
    stream?.getTracks().forEach(t => t.stop());
    video.srcObject = null;
    snapBtn.disabled = true;
    stopBtn.disabled = true;
    setStatus("ØªÙ… Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù");
  };

  snapBtn.onclick = async () => {
    const c = document.createElement("canvas");
    c.width = video.videoWidth;
    c.height = video.videoHeight;
    c.getContext("2d").drawImage(video,0,0);
    const img = c.toDataURL("image/jpeg",0.9);

    preview.src = img;
    preview.style.display = "block";
    setStatus("Ø¬Ø§Ø±Ù Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...");

    const r = await fetch(API_BASE+"/upload",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({imageDataUrl:img})
    });

    setStatus(r.ok ? "âœ… ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„ØªÙ„ØºØ±Ø§Ù…" : "âŒ ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„");
  };
</script>
</body>
</html>
